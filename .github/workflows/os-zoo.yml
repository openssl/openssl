# Copyright 2021-2025 The OpenSSL Project Authors. All Rights Reserved.
#
# Licensed under the Apache License 2.0 (the "License").  You may not use
# this file except in compliance with the License.  You can obtain a copy
# in the file LICENSE in the source distribution or at
# https://www.openssl.org/source/license.html

name: OS Zoo CI

on: [pull_request]

permissions:
  contents: read

jobs:
  linux-arm64:
    runs-on: linux-arm64
    steps:
    - uses: actions/checkout@v4
    - name: config
      run: ./config enable-fips enable-ec_nistp_64_gcc_128 enable-md2 enable-rc5 enable-ssl3 enable-ssl3-method enable-trace
    - name: config dump
      run: ./configdata.pm --dump
    - name: make
      run: make -j4
    - name: get cpu info
      run: ./util/opensslwrap.sh version -c
    - name: make test
      run: make test HARNESS_JOBS=${HARNESS_JOBS:-4}

  linux-ppc64le:
    runs-on: linux-ppc64le
    if: github.repository == 'openssl/openssl'
    steps:
    - uses: actions/checkout@v4
    - name: config
      run: ./config enable-fips enable-ec_nistp_64_gcc_128 enable-md2 enable-rc5 enable-ssl3 enable-ssl3-method enable-trace
    - name: config dump
      run: ./configdata.pm --dump
    - name: make
      run: make -j4
    - name: get cpu info
      run: |
        cat /proc/cpuinfo
        ./util/opensslwrap.sh version -c
    - name: make test
      run: make test HARNESS_JOBS=${HARNESS_JOBS:-4}

  linux-s390x:
    runs-on: linux-s390x
    if: github.repository == 'openssl/openssl'
    steps:
    - uses: actions/checkout@v4
    - name: config
      run: ./config enable-fips enable-md2 enable-rc5 enable-ssl3 enable-ssl3-method enable-trace
    - name: config dump
      run: ./configdata.pm --dump
    - name: make
      run: make -j4
    - name: get cpu info
      run: |
        cat /proc/cpuinfo
        ./util/opensslwrap.sh version -c
    - name: make test
      run: make test HARNESS_JOBS=${HARNESS_JOBS:-4}

  linux-riscv64-no-fips:
    runs-on: linux-riscv64
    if: github.repository == 'openssl/openssl'
    steps:
    - uses: actions/checkout@v4
    - name: config
      run: ./config enable-ec_nistp_64_gcc_128 enable-md2 enable-rc5 enable-ssl3 enable-ssl3-method enable-trace
    - name: config dump
      run: ./configdata.pm --dump
    - name: make
      run: make -j8
    - name: get cpu info
      run: ./util/opensslwrap.sh version -c
    - name: make test
      env:
        OPENSSL_riscvcap: RV64GC_ZBA_ZBB_ZBC_ZBS_ZKT_V
      run: make test HARNESS_JOBS=${HARNESS_JOBS:-4}

  linux-riscv64:
    runs-on: linux-riscv64
    if: github.repository == 'openssl/openssl'
    steps:
    - uses: actions/checkout@v4
    - name: config
      run: ./config enable-fips enable-ec_nistp_64_gcc_128 enable-md2 enable-rc5 enable-ssl3 enable-ssl3-method enable-trace
    - name: config dump
      run: ./configdata.pm --dump
    - name: make
      run: make -j8
    - name: get cpu info
      run: ./util/opensslwrap.sh version -c
    - name: make test
      env:
        OPENSSL_riscvcap: RV64GC_ZBA_ZBB_ZBC_ZBS_ZKT_V
      run: make test HARNESS_JOBS=${HARNESS_JOBS:-4}

  freebsd-x86_64:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: config
      uses: cross-platform-actions/action@fe0167d8082ac584754ef3ffb567fded22642c7d #v0.27.0
      with:
        operating_system: freebsd
        version: "13.4"
        shutdown_vm: false
        run: |
          sudo pkg install -y gcc perl5
          ./config enable-fips enable-ec_nistp_64_gcc_128 enable-md2 enable-rc5 enable-ssl3 enable-ssl3-method enable-trace
    - name: config dump
      uses: cross-platform-actions/action@fe0167d8082ac584754ef3ffb567fded22642c7d #v0.27.0
      with:
        operating_system: freebsd
        version: "13.4"
        shutdown_vm: false
        run: ./configdata.pm --dump
    - name: make
      uses: cross-platform-actions/action@fe0167d8082ac584754ef3ffb567fded22642c7d #v0.27.0
      with:
        operating_system: freebsd
        version: "13.4"
        shutdown_vm: false
        run: make -j4
    - name: make test
      uses: cross-platform-actions/action@fe0167d8082ac584754ef3ffb567fded22642c7d #v0.27.0
      with:
        operating_system: freebsd
        version: "13.4"
        run: |
          ./util/opensslwrap.sh version -c
          .github/workflows/make-test
