=pod

=head1 NAME

CRYPTO_BUFFER_POOL_new, CRYPTO_BUFFER_POOL_free,
CRYPTO_BUFFER_new, CRYPTO_BUFFER_alloc,
CRYPTO_BUFFER_new_from_static_data_unsafe,
CRYPTO_BUFFER_free, CRYPTO_BUFFER_up_ref,
CRYPTO_BUFFER_data, CRYPTO_BUFFER_len
- Buffers and Buffer pools

=head1 SYNOPSIS

 #include "internal/pool.h"

 CRYPTO_BUFFER_POOL *CRYPTO_BUFFER_POOL_new(void);

 void CRYPTO_BUFFER_POOL_free(CRYPTO_BUFFER_POOL *pool);

 CRYPTO_BUFFER *CRYPTO_BUFFER_new(const uint8_t *data, size_t len,
    CRYPTO_BUFFER_POOL *pool);

 CRYPTO_BUFFER *CRYPTO_BUFFER_alloc(uint8_t **out_data,
     size_t len);

 CRYPTO_BUFFER *CRYPTO_BUFFER_new_from_static_data_unsafe(const uint8_t *data,
    size_t len, CRYPTO_BUFFER_POOL *pool);

 void CRYPTO_BUFFER_free(CRYPTO_BUFFER *buf);

 int CRYPTO_BUFFER_up_ref(CRYPTO_BUFFER *buf);

 const uint8_t *CRYPTO_BUFFER_data(const CRYPTO_BUFFER *buf);

 size_t CRYPTO_BUFFER_len(const CRYPTO_BUFFER *buf);

=head1 DESCRIPTION

I<CRYPTO_BUFFER>s are simply reference-counted blobs of bytes. A I<CRYPTO_BUFFER_POOL>
is an internal table for I<CRYPTO_BUFFER>s. This allows for a single copy of a
given blob to be kept in memory and referenced from multiple places. I<CRYPTO_BUFFER>s
may be created pooled, or unpooled.

When unpooled, I<CRYPTO_BUFFER> is just a reference counted independently
allocated object. When pooled, all I<CRYPTO_BUFFER>'s from the pool with the
same blob of bytes will point the a single copy of the blob in memory.

I<CRYPTO_BUFFER_POOL_new> returns a freshly allocated I<CRYPTO_BUFFER_POOL> or
 NULL on error.

I<CRYPTO_BUFFFER_POOL_free> frees |pool|, which must be empty.

I<CRYPTO_BUFFER_new> returns a I<CRYPTO_BUFFER> containing a copy of I<data>, or
else NULL on error. If I<pool> is not NULL then the returned value may be a
reference to a previously existing I<CRYPTO_BUFFER> that contained the same
data. Otherwise, the returned, fresh I<CRYPTO_BUFFER> will be added to the
pool.

I<CRYPTO_BUFFER_alloc> creates an unpooled I<CRYPTO_BUFFER> of the
given size and writes the underlying data pointer to I<*out_data>. It
returns NULL on error.  After calling this function, I<len> bytes of
contents must be written to I<out_data> before passing the returned
pointer to any other function.  Once initialized, the I<CRYPTO_BUFFER>
should be treated as immutable.

I<CRYPTO_BUFFER_new_from_static_data_unsafe> behaves like
I<CRYPTO_BUFFER_new> but does not copy I<data>. I<data> must be
immutable and last for the lifetime of the address space.

I<CRYPTO_BUFFER_free> decrements the reference count of I<buf>. If there are no
other references, or if the only remaining reference is from a pool, then
I<buf> will be freed.

I<CRYPTO_BUFFER_up_ref> increments the reference count of I<buf> and returns
one.

I<CRYPTO_BUFFER_data> returns a pointer to the data contained in I<buf>.

I<CRYPTO_BUFFER_len> returns the length, in bytes, of the data contained in
I<buf>.

=head1 HISTORY

These functions were originally developed in BoringSSL, and are public API
in BoringSSL.

=head1 COPYRIGHT

Copyright 2025 The OpenSSL Project Authors. All Rights Reserved.

Licensed under the Apache License 2.0 (the "License").  You may not use
this file except in compliance with the License.  You can obtain a copy
in the file LICENSE in the source distribution or at
L<https://www.openssl.org/source/license.html>.

=cut
